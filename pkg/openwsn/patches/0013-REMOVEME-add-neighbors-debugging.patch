From eb33e9c0f4623564a99b77d8e178764e86d25485 Mon Sep 17 00:00:00 2001
From: Francisco Molina <femolina@uc.cl>
Date: Mon, 2 Nov 2020 12:04:37 +0100
Subject: [PATCH 13/15] REMOVEME: add neighbors debugging

---
 inc/opendefs.h                    | 3 ++-
 openstack/02b-MAChigh/neighbors.c | 3 +++
 2 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/inc/opendefs.h b/inc/opendefs.h
index 6a263ca0..aa9fe5ac 100644
--- a/inc/opendefs.h
+++ b/inc/opendefs.h
@@ -239,7 +239,7 @@ enum {
    ERR_NO_RECEIVED_PACKET              = 0x23, // there is no received packet in queue
    ERR_SCHEDULE_OVERFLOWN              = 0x24, // schedule overflown
    ERR_SIXTOP_RETURNCODE               = 0x25, // sixtop return code {0} at sixtop state {1}
-   ERR_SIXTOP_REQUEST                  = 0x26, // sending a 6top request
+   ERR_SIXTOP_REQUEST                  = 0x26, // sending a 6top request {0}
    ERR_SIXTOP_COUNT                    = 0x27, // there are {0} cells to request mote
    ERR_SIXTOP_LIST                     = 0x28, // the cells reserved to request mote contains slot {0} and slot {1}
    ERR_UNSUPPORTED_FORMAT              = 0x29, // the received packet format is not supported (code location {0})
@@ -290,6 +290,7 @@ enum {
    ERR_INVALID_PARAM                   = 0x53, // received an invalid parameter
    ERR_COPY_TO_SPKT                    = 0x54, // copy packet content to small packet (pkt len {} < max len {})
    ERR_COPY_TO_BPKT                    = 0x55, // copy packet content to big packet (pkt len {} > max len {})
+   ERR_NEW_NEIGHBOR                    = 0x56, // New neighbor candidate with RSSI {0},
 };
 
 //=========================== typedef =========================================
diff --git a/openstack/02b-MAChigh/neighbors.c b/openstack/02b-MAChigh/neighbors.c
index 50fc87c0..8f5d5316 100644
--- a/openstack/02b-MAChigh/neighbors.c
+++ b/openstack/02b-MAChigh/neighbors.c
@@ -684,6 +684,9 @@ void registerNewNeighbor(open_addr_t *address,
                 if (rssi < GOODNEIGHBORMINRSSI) {
                     break;
                 }
+                LOG_SUCCESS(COMPONENT_NEIGHBORS, ERR_NEW_NEIGHBOR,
+                            (errorparameter_t) rssi,
+                            (errorparameter_t) 0);
                 // add this neighbor
                 neighbors_vars.neighbors[i].used = TRUE;
                 neighbors_vars.neighbors[i].insecure = insecure;
-- 
2.28.0

